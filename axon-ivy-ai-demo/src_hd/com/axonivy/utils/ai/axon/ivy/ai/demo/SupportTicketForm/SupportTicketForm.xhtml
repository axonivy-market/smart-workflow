<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/frame-10-full-width.xhtml">
    <ui:define name="title">Support ticket</ui:define>
    <!-- <ui:define name="content">

      <h3>Please ask your question</h3>

      <h:form id="dropZone" enctype="multipart/form-data">
        <div class="ui-fluid">
          <div class="field">
            <p:inputTextarea id="customDropZone" widgetVar="textarea" autoResize="false" rows="5" value="#{data.ticketDescription}" />
            <small> You can drop on the text area to upload log/screenshot, or <p:link value="choose"
                onclick="PF('uploadDnd').show();return false" style="font-size:inherit" />.
            </small>
          </div>
        </div>
        <div class="field">
          
        </div>

        <p:fileUpload id="upload" widgetVar="uploadDnd" 
          mode="advanced" auto="true" dropZone="customDropZone" update="@form" style="display: none">
        </p:fileUpload>
        <div class="command-btns">
          <p:commandButton value="Send" process="@form" update="@form" actionListener="#{logic.close}"/>
        </div>

      </h:form>
    </ui:define> -->
    
    
    
    <ui:define name="content">

      <div class="card">
        <h:form id="chatForm">
          <p:panel header="Axon Ivy Support"
            style="max-width: 100%; margin: 0 auto; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); background: #fafbfc;">

            <p:scrollPanel id="chatArea" mode="native"
              style="height: 750px; overflow-y: auto; background: #f5f7fa; border-radius: 12px;">
              <ui:repeat value="#{chatBean.chatHistory}" var="msg">
                <p:outputPanel styleClass="msg-row #{msg.role eq 'user' ? 'user-row' : 'bot-row'}">
                  <div class="msg-bubble #{msg.role eq 'user' ? 'user-bubble' : 'bot-bubble'}">
                    <span class="msg-sender">#{msg.role eq 'user' ? 'You' : 'Axon Ivy Support'}</span> <span class="msg-content">
                      <h:outputText value="#{msg.htmlContent}" escape="#{msg.role eq 'user'}" />
                    </span> <span class="msg-time">#{msg.timestamp}</span>
                  </div>
                </p:outputPanel>
              </ui:repeat>

              <h:panelGroup rendered="#{chatBean.botTyping}">
                <div class="msg-row bot-row">
                  <div class="msg-bubble bot-bubble">
                    <span class="msg-sender">AI</span> <span class="msg-content"><i>Bot is typing...</i></span>
                  </div>
                </div>
              </h:panelGroup>
            </p:scrollPanel>
            <p:separator />

            <h:panelGrid cellpadding="5" style="width:100%;">
              <p:inputTextarea id="userInput" value="#{chatBean.userMessage}" styleClass="w-full" 
                placeholder="Type your question..."
                onkeypress="if(event.keyCode==13){PF('sendBtn').jq.click();return false;}" />
              <p:commandButton id="sendBtn" value="Send" icon="pi pi-send" action="#{chatBean.sendMessage}"
                update="chatArea userInput" process="@form" disabled="#{chatBean.botTyping}" />
            </h:panelGrid>
          </p:panel>
        </h:form>
      </div>
      <style>
.msg-row {
  display: flex;
  align-items: flex-end;
  margin-bottom: 10px;
}

.user-row {
  flex-direction: row-reverse;
}

.bot-row {
  flex-direction: row;
}

.msg-bubble {
  border-radius: 12px;
  padding: 10px 14px;
  max-width: 80%;
  display: inline-block;
  word-wrap: break-word;
}

.user-bubble {
  background-color: #daf0ff;
  color: #003366;
  margin-left: auto;
  text-align: right;
}

.bot-bubble {
  background-color: #f0f0f0;
  color: #333;
  margin-right: auto;
  text-align: left;
}

.msg-sender {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
  font-size: 0.9em;
}

.msg-content {
  white-space: pre-wrap;
}

.msg-time {
  display: block;
  font-size: 0.75em;
  color: #888;
  margin-top: 4px;
  text-align: right;
}
</style>
    </ui:define> 
    
    
    
  </ui:composition>
</h:body>

</html>
