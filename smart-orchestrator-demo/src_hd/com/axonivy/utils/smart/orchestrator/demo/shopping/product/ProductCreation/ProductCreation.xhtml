<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/frame-10-full-width.xhtml">
    <ui:define name="title">ProductCreation</ui:define>
    <ui:define name="content">
      <h:outputStylesheet library="css" name="shopping-common.css" />
      <h:outputStylesheet library="css" name="shopping-product-creation.css" />
      <h:outputScript name="shopping-product-creation.js" library="js" />
      <h3>Product Creation</h3>

      <!-- Enhanced Upload Form -->
      <h:form id="upload-form" rendered="#{data.isShowUploadSection}">
        <div class="bg-white border-round-xl p-4 shadow-2 border-1 surface-border">
          <h:panelGroup layout="block" styleClass="grid js-file-upload">
            <!-- Document Upload Section -->
            <div class="col-12 lg:col-6">
              <div class="bg-gray-50 border-round-lg overflow-hidden border-2 surface-border transition-all transition-duration-300 hover:border-primary">
                <div class="p-3 bg-white border-bottom-1 surface-border flex align-items-center gap-3">
                  <div class="w-3rem h-3rem border-circle flex align-items-center justify-content-center text-white" style="background: linear-gradient(45deg, #3498db, #2980b9);">
                    <i class="pi pi-file-text text-xl"></i>
                  </div>
                  <div class="flex-1">
                    <h5 class="m-0 mb-1 text-lg font-semibold text-900">Product Specification</h5>
                    <p class="m-0 text-600 text-sm">Product document with detailed specifications</p>
                  </div>
                  <div>
                    <i class="pi pi-info-circle text-primary cursor-pointer hover:text-primary-600 transition-colors transition-duration-300" 
                       onclick="PF('doc-info-dialog').show();" 
                       title="Show requirements"></i>
                  </div>
                </div>
                
                <div class="p-4 text-center transition-all transition-duration-300">
                <p:fileUpload label="Choose Document" 
                              listener="#{logic.handleUpload}" 
                              multiple="false"
                              mode="advanced" 
                              auto="true" 
                              update="@form"
                              styleClass="upload-component doc-upload"
                              onupload="updateUploadStatus('doc', 'success')"
                              onerror="updateUploadStatus('doc', 'error')"
                              dragDropSupport="true"
                              allowTypes="/(\.|\/)(pdf|md)$/"
                              uploadLabel="Upload Document"
                              cancelLabel="Cancel" />
                
                  <div class="flex flex-column gap-2 mt-3">
                    <div class="flex align-items-center justify-content-center gap-2 text-sm text-600">
                      <i class="pi pi-upload text-primary"></i>
                      <span>Drag and drop your document here, or click to browse</span>
                    </div>
                    <div class="flex align-items-center justify-content-center gap-2 text-sm text-500">
                      <i class="pi pi-info-circle"></i>
                      <span>Supported formats: PDF, MD (Max: 10MB)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Image Upload Section -->
            <div class="col-12 lg:col-6">
              <div class="bg-gray-50 border-round-lg overflow-hidden border-2 surface-border transition-all transition-duration-300 hover:border-primary">
                <div class="p-3 bg-white border-bottom-1 surface-border flex align-items-center gap-3">
                  <div class="w-3rem h-3rem border-circle flex align-items-center justify-content-center text-white" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                    <i class="pi pi-image text-xl"></i>
                  </div>
                  <div class="flex-1">
                    <h5 class="m-0 mb-1 text-lg font-semibold text-900">Product Image</h5>
                    <p class="m-0 text-600 text-sm">A high-quality product image for the catalog</p>
                  </div>
                  <div>
                    <i class="pi pi-info-circle text-primary cursor-pointer hover:text-primary-600 transition-colors transition-duration-300" 
                       onclick="PF('image-info-dialog').show();" 
                       title="Show requirements"></i>
                  </div>
                </div>

                <div class="p-4 text-center transition-all transition-duration-300">
                <p:fileUpload label="Choose Image" 
                              listener="#{logic.handleUploadImage}" 
                              multiple="false"
                              mode="advanced" 
                              auto="true" 
                              update="@form"
                              styleClass="upload-component image-upload"
                              onupload="updateUploadStatus('image', 'success')"
                              onerror="updateUploadStatus('image', 'error')"
                              dragDropSupport="true"
                              allowTypes="/(\.|\/)(png)$/"
                              uploadLabel="Upload Image"
                              cancelLabel="Cancel" />

                  <div class="flex flex-column gap-2 mt-3">
                    <div class="flex align-items-center justify-content-center gap-2 text-sm text-600">
                      <i class="pi pi-upload text-primary"></i>
                      <span>Drag and drop your image here, or click to browse</span>
                    </div>
                    <div class="flex align-items-center justify-content-center gap-2 text-sm text-500">
                      <i class="pi pi-info-circle"></i>
                      <span>Supported formats: PNG (Min: 800x600px, Max: 5MB)</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </h:panelGroup>

          <!-- Action Buttons -->
          <h:panelGroup layout="block" styleClass="flex flex-column gap-3 js-proceed-button"
            rendered="#{data.isShowUploadSection}">
            <div class="flex justify-content-center gap-3 mt-3">
              <p:commandButton id="proceed-button"
                              value="Analyze and Create Product" 
                              actionListener="#{logic.dryRun}" 
                              process="@form" 
                              styleClass="p-button-primary p-button-lg proceed-btn js-proceed-button"
                              update="@form result-form"
                              global="false"
                              onstart="showRunningText();"
                              oncomplete="hideRunningText();"
                              disabled="#{empty data.productInfo}"
                              icon="pi pi-cog" />
            </div>
          </h:panelGroup>
          
          <!-- AI Processing Indicator -->
          <div class="text-center p-6 bg-gray-50 border-round-xl border-2 surface-border js-processing-text hidden">
            <div class="ai-animation mb-4 relative flex justify-content-center align-items-center" style="height: 120px;">
              <div class="ai-brain w-5rem h-5rem bg-primary border-circle flex align-items-center justify-content-center text-white text-2xl relative z-2">
                <i class="pi pi-android"></i>
              </div>
              <div class="ai-waves absolute top-50 left-50 transform-translate-50">
                <div class="wave wave-1"></div>
                <div class="wave wave-2"></div>
                <div class="wave wave-3"></div>
              </div>
            </div>
            <div>
              <h4 class="text-900 mb-3 text-xl font-semibold">AI Agent is Processing Your Documents</h4>
              <p class="text-600 mb-4 text-lg line-height-3">Our intelligent system is analyzing your product specification and image. This may take a few minutes...</p>
              <div class="flex flex-column gap-3 text-left max-w-25rem mx-auto">
                <div class="ai-step p-3 bg-white border-round border-left-3 surface-border text-600 transition-all transition-duration-500 opacity-50">üìÑ Reading product specification</div>
                <div class="ai-step p-3 bg-white border-round border-left-3 surface-border text-600 transition-all transition-duration-500 opacity-50">üîç Extracting product details</div>
                <div class="ai-step p-3 bg-white border-round border-left-3 surface-border text-600 transition-all transition-duration-500 opacity-50">üñºÔ∏è Processing product image</div>
                <div class="ai-step p-3 bg-white border-round border-left-3 surface-border text-600 transition-all transition-duration-500 opacity-50">‚úÖ Preparing product data</div>
              </div>
            </div>
          </div>
          
        </div>
      </h:form>

        <h:form id="result-form">
        <!-- Blocking message when dependencies don't exist -->
        <h:panelGroup id="dependencies-missing" layout="block" styleClass="mt-4 p-4 border-round-lg surface-border bg-red-50 border-left-3 border-red-500" 
                      rendered="#{data.response ne null and (!data.response.isSupplierExisting or !data.response.isCategoryExisting or !data.response.isBrandExisting)}">
          <div class="flex flex-column gap-4">
            <div class="flex align-items-center gap-2">
              <i class="pi pi-exclamation-triangle text-red-600 text-xl"></i>
              <span class="text-red-700 font-semibold text-lg">Cannot create product - missing dependencies</span>
            </div>
            <p class="text-700 m-0 mb-3">You must create the required supplier and product category before creating a new product.</p>

            <!-- Missing Supplier -->
            <h:panelGroup rendered="#{!data.response.isSupplierExisting}">
              <div class="flex align-items-center justify-content-between p-3 bg-white border-round surface-border border-1">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-building text-red-500"></i>
                  <span class="text-800 font-medium">Supplier does not exist</span>
                </div>
                <p:commandButton value="Resolve" type="button" 
                                onclick="PF('create-supplier-dialog').show();" 
                                styleClass="p-button-sm p-button-success" 
                                icon="pi pi-check" />
              </div>
            </h:panelGroup>

            <!-- Missing Category -->
            <h:panelGroup rendered="#{!data.response.isCategoryExisting}">
              <div class="flex align-items-center justify-content-between p-3 bg-white border-round surface-border border-1">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-tags text-red-500"></i>
                  <span class="text-800 font-medium">Product category does not exist</span>
                </div>
                <p:commandButton value="Resolve" type="button" 
                                onclick="PF('create-category-dialog').show();" 
                                styleClass="p-button-sm p-button-success" 
                                icon="pi pi-check" />
              </div>
            </h:panelGroup>
            
            <!-- Missing Brand -->
            <h:panelGroup rendered="#{!data.response.isBrandExisting}">
              <div class="flex align-items-center justify-content-between p-3 bg-white border-round surface-border border-1">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-tags text-red-500"></i>
                  <span class="text-800 font-medium">Brand does not exist</span>
                </div>
                <p:commandButton value="Resolve" type="button" 
                                onclick="PF('create-brand-dialog').show();" 
                                styleClass="p-button-sm p-button-success" 
                                icon="pi pi-check" />
              </div>
            </h:panelGroup>
          </div>
        </h:panelGroup>

        <!-- Success message when all dependencies exist -->
        <h:panelGroup id="dependencies-ready" layout="block" styleClass="mt-4 p-4 border-round-lg surface-border bg-green-50 border-left-3 border-green-500" 
                      rendered="#{(data.response.isSupplierExisting and data.response.isCategoryExisting and data.response.isBrandExisting and !data.response.isProductExisting) and !(data.response ne null and data.isProductCreated)}">
          <div class="flex flex-column gap-4">
            <div class="flex align-items-center gap-2">
              <i class="pi pi-check-circle text-green-600 text-xl"></i>
              <span class="text-green-700 font-semibold text-lg">All dependencies matched</span>
            </div>
            <p class="text-700 m-0 mb-3">All required dependencies are available. Do you want to create a new product with the details below?</p>
          </div>
        </h:panelGroup>

        <!-- Success message when product is created -->
        <h:panelGroup id="product-created-success" layout="block" styleClass="mt-4 p-4 border-round-lg surface-border bg-green-50 border-left-3 border-green-500" 
                      rendered="#{data.response ne null and data.isProductCreated}">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-check-circle text-green-600 text-xl"></i>
            <div>
              <div class="text-green-700 font-semibold text-lg">Product created successfully!</div>
              <div class="text-700 mt-1">Your product has been created and added to the inventory.</div>
            </div>
          </div>
        </h:panelGroup>

        <!-- Product Details Preview when all dependencies exist -->
        <h:panelGroup id="product-preview" layout="block" styleClass="mt-4" 
                      rendered="#{data.response.isSupplierExisting and data.response.isCategoryExisting and data.response.isBrandExisting and !data.response.isProductExisting and !(data.response ne null and data.isProductCreated)}">
          <div class="card">
            <h4 class="mb-3">Product Preview</h4>
            <ic:com.axonivy.utils.smart.orchestrator.demo.shopping.product.components.ProductDetails
              product="#{data.response.product}" tempImg="#{data.imageBase64}" />
          </div>
        </h:panelGroup>
        <h:panelGroup class="flex justify-content-end mt-3"
          rendered="#{data.response ne null and !(data.response ne null and data.isProductCreated)}" layout="block">
              <p:commandButton value="Create New Product" actionListener="#{logic.createProduct}"
                              update="@form #{p:resolveFirstComponentWithId('upload-form', view).clientId}"
                              process="@form" styleClass="p-button-success p-button-lg" 
                              disabled="#{!(data.response.isBrandExisting and data.response.isCategoryExisting and data.response.isSupplierExisting)}"
                              icon="pi pi-plus" />
        </h:panelGroup>
      </h:form>
    <ui:include src="SupplierCreationDialog.xhtml" />
    <ui:include src="ProductCategoryCreationDialog.xhtml" />
    <ui:include src="BrandCreationDialog.xhtml" />

    <!-- Product Specification Info Modal -->
    <p:dialog id="spec-info-modal" header="Product Specification Requirements" 
              widgetVar="doc-info-dialog" modal="true" resizable="false" 
              styleClass="info-modal" width="600">
      <div class="p-4">
        <h4><i class="pi pi-file-text"></i> Product Specification Document</h4>
        <p>Please upload a comprehensive document containing the product's technical details.</p>
        
        <h5>Required Information:</h5>
        <ul>
          <li><strong>Product Name:</strong> Clear, descriptive product title</li>
          <li><strong>Detailed Description:</strong> Features, benefits, use cases</li>
          <li><strong>Technical Specifications:</strong> Dimensions, weight, materials</li>
          <li><strong>Performance Metrics:</strong> Speed, capacity, efficiency ratings</li>
          <li><strong>Compatibility:</strong> System requirements, compatible products</li>
          <li><strong>Safety Information:</strong> Warnings, certifications, compliance</li>
        </ul>
        
        <h5>Accepted Formats:</h5>
        <div class="format-tags">
          <span class="bg-primary-100 text-primary-700 px-3 py-2 border-round-lg text-sm font-medium border-1 border-primary-300">PDF</span>
          <span class="bg-primary-100 text-primary-700 px-3 py-2 border-round-lg text-sm font-medium border-1 border-primary-300">MD</span>
        </div>
        
        <div class="bg-blue-50 p-4 border-round mt-4 border-left-3 border-blue-400">
          <h5><i class="pi pi-lightbulb"></i> Tips for Better Results:</h5>
          <ul>
            <li>Use clear, structured formatting with headings</li>
            <li>Include bullet points for features and specifications</li>
            <li>Ensure text is machine-readable (not scanned images)</li>
            <li>Maximum file size: 10MB</li>
          </ul>
        </div>
      </div>
    </p:dialog>

    <!-- Product Image Info Modal -->
    <p:dialog id="image-info-modal" header="Product Image Requirements" 
              widgetVar="imageInfoDialog" modal="true" resizable="false" 
              styleClass="info-modal" width="600">
      <div class="p-4">
        <h4><i class="pi pi-image"></i> Product Image</h4>
        <p>Upload a high-quality image that best represents your product.</p>
        
        <h5>Image Guidelines:</h5>
        <ul>
          <li><strong>Quality:</strong> High resolution (minimum 800x600 pixels)</li>
          <li><strong>Format:</strong> Clear, well-lit, professional appearance</li>
          <li><strong>Background:</strong> Plain or neutral background preferred</li>
          <li><strong>Focus:</strong> Product should be the main subject</li>
          <li><strong>Angle:</strong> Show product from the most informative angle</li>
          <li><strong>Lighting:</strong> Even lighting without harsh shadows</li>
        </ul>
        
        <h5>Accepted Formats:</h5>
        <div class="format-tags">
          <span class="bg-primary-100 text-primary-700 px-3 py-2 border-round-lg text-sm font-medium border-1 border-primary-300">PNG</span>
        </div>
        
        <div class="bg-blue-50 p-4 border-round mt-4 border-left-3 border-blue-400">
          <h5><i class="pi pi-lightbulb"></i> Tips for Better Results:</h5>
          <ul>
            <li>Use natural lighting or professional photography setup</li>
            <li>Avoid blurry or pixelated images</li>
            <li>Ensure product fills most of the frame</li>
            <li>Maximum file size: 5MB</li>
            <li>Consider multiple angles if product has complex features</li>
          </ul>
        </div>
      </div>
    </p:dialog>

    </ui:define>
  </ui:composition>
</h:body>

</html>
